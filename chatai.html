<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>minimalist ai chat</title>
    <!-- tailwind css for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- puter.js for free ai access -->
    <script src="https://js.puter.com/v2/"></script>
    <!-- marked.js to render markdown responses -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- google fonts for a clean look -->
    <link href="https://fonts.googleapis.com/css2?family=inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* basic styling and font definition */
        body { 
            font-family: 'inter', sans-serif; 
            background-color: #111827; /* dark gray background */
            color: #d1d5db; /* light gray text */
        }
        /* custom scrollbar for a cleaner aesthetic in dark mode */
        #chat-log::-webkit-scrollbar { 
            width: 6px; 
        }
        #chat-log::-webkit-scrollbar-track { 
            background: transparent; 
        }
        #chat-log::-webkit-scrollbar-thumb { 
            background: #4b5563; /* medium gray thumb */
            border-radius: 3px; 
        }
        #chat-log::-webkit-scrollbar-thumb:hover { 
            background: #6b7280; /* lighter gray on hover */
        }
        /* styles for markdown-rendered content */
        .prose {
            color: #d1d5db;
        }
        .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
            color: #f9fafb;
        }
        .prose strong {
            color: #f9fafb;
        }
        .prose a {
            color: #60a5fa;
        }
        .prose code {
            background-color: #1f2937;
            color: #e5e7eb;
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            border-radius: 6px;
        }
        .prose pre {
            background-color: #1f2937;
            color: #e5e7eb;
            padding: 1em;
            border-radius: 8px;
            overflow-x: auto;
        }
        .prose pre code {
            background-color: transparent;
            padding: 0;
        }
        .prose ul, .prose ol {
            padding-left: 1.5em;
        }
        .prose blockquote {
            border-left: 4px solid #4b5563;
            padding-left: 1em;
            color: #9ca3af;
        }
    </style>
</head>
<body class="flex flex-col h-screen">

    <!-- header section -->
    <header class="p-4 border-b border-gray-700 bg-gray-900/80 backdrop-blur-md sticky top-0 z-10">
        <h1 class="text-xl font-semibold text-gray-100 text-center">ai chat</h1>
        <div class="flex items-center justify-center gap-2 mt-1">
            <span id="powered-by-text" class="text-xs text-gray-400"></span>
            <select id="model-selector" class="bg-gray-700 border border-gray-600 text-gray-200 text-xs rounded-md focus:ring-indigo-500 focus:border-indigo-500 block w-auto p-1">
                <optgroup label="OpenAI">
                    <option value="gpt-4.1" selected>gpt-4.1</option>
                    <option value="gpt-4o">gpt-4o</option>
                    <option value="gpt-4.5-preview">gpt-4.5-preview</option>
                    <option value="gpt-4.1-mini">gpt-4.1-mini</option>
                    <option value="gpt-4.1-nano">gpt-4.1-nano</option>
                    <option value="gpt-4o-mini">gpt-4o-mini</option>
                    <option value="gpt-5">gpt-5</option>
                    <option value="gpt-5-mini">gpt-5-mini</option>
                    <option value="gpt-5-nano">gpt-5-nano</option>
                    <option value="gpt-5-chat-latest">gpt-5-chat-latest</option>
                    <option value="o1">o1</option>
                    <option value="o1-mini">o1-mini</option>
                    <option value="o1-pro">o1-pro</option>
                    <option value="o3">o3</option>
                    <option value="o3-mini">o3-mini</option>
                    <option value="o4-mini">o4-mini</option>
                </optgroup>
                <optgroup label="Claude">
                    <option value="claude-sonnet-4">claude-sonnet-4</option>
                    <option value="claude-opus-4">claude-opus-4</option>
                </optgroup>
                <optgroup label="Grok">
                    <option value="x-ai/grok-4">grok-4</option>
                    <option value="x-ai/grok-3">grok-3</option>
                    <option value="x-ai/grok-3-beta">grok-3-beta</option>
                    <option value="x-ai/grok-3-mini">grok-3-mini</option>
                    <option value="x-ai/grok-3-mini-beta">grok-3-mini-beta</option>
                    <option value="x-ai/grok-2-1212">grok-2-1212</option>
                    <option value="x-ai/grok-2-vision-1212">grok-2-vision-1212</option>
                    <option value="x-ai/grok-vision-beta">grok-vision-beta</option>
                </optgroup>
            </select>
        </div>
    </header>

    <!-- chat messages container -->
    <main id="chat-log" class="flex-1 overflow-y-auto p-4 md:p-6 space-y-6">
        <!-- chat history will be rendered here by javascript -->
    </main>

    <!-- user input form at the bottom -->
    <footer class="p-4 md:p-6 bg-gray-900/80 backdrop-blur-md border-t border-gray-700 sticky bottom-0">
        <div class="max-w-3xl mx-auto">
            <form id="chat-form" class="flex items-center gap-3">
                <input id="chat-input" type="text" placeholder="ask me anything..." class="flex-1 p-3 bg-gray-700 border border-gray-600 rounded-full text-gray-200 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition duration-200" autocomplete="off">
                <button type="submit" id="send-button" class="bg-indigo-600 text-white rounded-full p-3 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition duration-200 disabled:bg-indigo-800 disabled:cursor-not-allowed">
                    <!-- send icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>
                </button>
            </form>
        </div>
    </footer>

    <script>
        // --- dom element references ---
        const chatLog = document.getElementById('chat-log');
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const modelSelector = document.getElementById('model-selector');
        const poweredByText = document.getElementById('powered-by-text');

        // --- conversation state ---
        let conversationHistory = [
            { role: 'assistant', content: 'hello! how can i help you today?' }
        ];

        // --- function to update the header text ---
        function updatePoweredByText() {
            const selectedModel = modelSelector.options[modelSelector.selectedIndex].text;
            poweredByText.textContent = `powered by ${selectedModel}`;
        }

        // --- initial render ---
        document.addEventListener('DOMContentLoaded', () => {
            renderHistory();
            updatePoweredByText();
            sendButton.disabled = true; // start with the send button disabled
        });

        // --- event listeners ---
        chatForm.addEventListener('submit', handleFormSubmit);
        chatInput.addEventListener('input', () => {
            sendButton.disabled = chatInput.value.trim() === '';
        });
        modelSelector.addEventListener('change', updatePoweredByText);


        /**
         * main function to handle the chat form submission.
         */
        async function handleFormSubmit(e) {
            e.preventDefault();
            const userInput = chatInput.value.trim();
            if (!userInput) return;
            
            // add user message to history and render it
            conversationHistory.push({ role: 'user', content: userInput });
            appendMessage('user', userInput);
            chatInput.value = '';
            sendButton.disabled = true;

            // create a placeholder for the ai's response
            const aiMessageContainer = createMessageContainer('assistant');
            chatLog.appendChild(aiMessageContainer);
            scrollToBottom();

            try {
                // get the currently selected model from the dropdown
                const selectedModel = modelSelector.value;

                // the puter.js library handles the login pop-up automatically
                const responseStream = await puter.ai.chat(conversationHistory, {
                    model: selectedModel,
                    stream: true
                });

                const aiMessageContent = aiMessageContainer.querySelector('.message-content');
                aiMessageContent.textContent = ''; // clear the typing indicator
                
                let fullResponse = '';
                // process the response stream chunk by chunk
                for await (const part of responseStream) {
                    const textChunk = part?.text || '';
                    fullResponse += textChunk;
                    aiMessageContent.textContent = fullResponse; // update ui with raw text for real-time feel
                    scrollToBottom();
                }

                // once streaming is done, render the final response as markdown
                aiMessageContent.innerHTML = marked.parse(fullResponse);
                aiMessageContent.classList.add('prose');

                // add the final ai response to history
                conversationHistory.push({ role: 'assistant', content: fullResponse });

            } catch (error) {
                console.error("error calling puter.ai:", error);
                const aiMessageContent = aiMessageContainer.querySelector('.message-content');
                aiMessageContent.textContent = "sorry, i encountered an error. please try again.";
                aiMessageContent.classList.add('text-red-400');
            }
        }

        // --- helper functions ---

        /**
         * renders the entire chat history to the screen.
         */
        function renderHistory() {
            chatLog.innerHTML = '';
            conversationHistory.forEach(message => {
                appendMessage(message.role, message.content);
            });
        }

        /**
         * creates and appends a single message bubble to the chat log.
         * @param {string} role - 'user' or 'assistant'.
         * @param {string} text - the message content.
         */
        function appendMessage(role, text) {
            const messageContainer = createMessageContainer(role, text);
            if (role === 'assistant') {
                const contentDiv = messageContainer.querySelector('.message-content');
                contentDiv.innerHTML = marked.parse(text);
                contentDiv.classList.add('prose');
            }
            chatLog.appendChild(messageContainer);
            scrollToBottom();
        }

        /**
         * builds the html structure for a single message bubble.
         * @param {string} role - 'user' or 'assistant'.
         * @param {string} [text] - optional message content. if not provided, shows a typing indicator for the 'assistant'.
         * @returns {HTMLElement} - the complete message container div.
         */
        function createMessageContainer(role, text) {
            const container = document.createElement('div');
            const isUser = role === 'user';

            if (isUser) {
                container.className = 'flex items-start gap-3 justify-end';
                container.innerHTML = `
                    <div class="bg-indigo-600 text-white rounded-xl p-3 max-w-lg shadow-lg">
                        <p class="message-content">${text}</p>
                    </div>
                    <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center text-gray-300 font-bold text-sm flex-shrink-0">you</div>
                `;
            } else {
                container.className = 'flex items-start gap-3';
                const content = text ? `<div class="message-content">${text}</div>` : `
                    <div class="message-content flex items-center space-x-1">
                        <span class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0s;"></span>
                        <span class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.2s;"></span>
                        <span class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.4s;"></span>
                    </div>`;
                
                container.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-white font-bold text-sm flex-shrink-0">ai</div>
                    <div class="bg-gray-800 rounded-xl p-3 max-w-lg shadow-lg">
                        ${content}
                    </div>
                `;
            }
            return container;
        }

        /**
         * automatically scrolls the chat log to the latest message.
         */
        function scrollToBottom() {
            chatLog.scrollTop = chatLog.scrollHeight;
        }
    </script>
</body>
</html>
